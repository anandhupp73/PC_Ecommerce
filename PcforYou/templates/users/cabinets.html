{% extends "index.html" %}
{% block title %}Cabinets{% endblock %}


{% block content %}
<div class="cabinet-product-page">

    <aside class="cabinet-filters">
    <h2>Filters</h2>

    <form method="GET" id="filterForm" action="{% url 'cabinets' %}">

        <!-- PRICE RANGE -->
        <div class="cabinet-filter-group">
            <h4>Max Price</h4>

            <div class="price-slider-wrapper">
                <input type="range"
                    id="priceSlider"
                    name="price"
                    min="0"
                    max="50000"
                    value="{{ max_price|default:'50000' }}">
                <div class="price-value">₹<span id="priceVal">{{ max_price|default:'30000' }}</span></div>
            </div>
        </div>

        <!-- FORM FACTOR -->
        <div class="cabinet-filter-group">
            <h4>Form Factor</h4>

            <label>
                <input type="checkbox" name="form_factor" value="Mini Tower"
                {% if selected_form_factors and 'Mini Tower' in selected_form_factors %}checked{% endif %}
                onchange="document.getElementById('filterForm').submit()">
                Mini Tower
            </label>

            <label>
                <input type="checkbox" name="form_factor" value="Mid Tower"
                {% if selected_form_factors and 'Mid Tower' in selected_form_factors %}checked{% endif %}
                onchange="document.getElementById('filterForm').submit()">
                Mid Tower
            </label>

            <label>
                <input type="checkbox" name="form_factor" value="Full Tower"
                {% if selected_form_factors and 'Full Tower' in selected_form_factors %}checked{% endif %}
                onchange="document.getElementById('filterForm').submit()">
                Full Tower
            </label>
        </div>

    </form>
</aside>


      <!-- PRODUCT LIST -->
    <main class="cabinet-products">
        <h2 style="color: white;">Cabinets</h2>

        <div class="shopc-product-grid">

            {% for cabinet in cabinet %}
            <div class="shopc-product-card">
                <a href="{% url 'product_detail' cabinet.id %}" style="text-decoration: none;">
                    <div class="shopc-img-box">
                        {% if cabinet.image %}
                        <img src="{{ cabinet.image.url }}" alt="{{ cabinet.name }}">
                        {% endif %}
                    </div>

                    <h3 class="shopc-product-name">{{ cabinet.name }}</h3>

                    <div class="shopc-product-bottom">
                        <span class="shopc-price">₹{{ cabinet.price }}</span>
                        <form action="{% url 'add_to_cart' cabinet.id %}" method="post">
                            {% csrf_token %}
                            <button class="shopc-add-btn">Add to Cart</button>
                        </form>
                    </div>
                </a>

                {% comment %} buy-now  {% endcomment %}

                
                <div class="buy-now-div">
                    <a href="#">
                    <button class="buy-now">Buy Now</button>
                    </a>
                </div>

            </div>
            {% empty %}
            <p style="color: white;">No products found for selected filters.</p>
            {% endfor %}

        </div>
    </main>

</div>
    <script>
    const slider = document.getElementById("priceSlider");
    const priceVal = document.getElementById("priceVal");
    const form = document.getElementById("filterForm");

    // Set initial fill
    slider.style.setProperty("--val", (slider.value / slider.max * 100) + "%");

    // Update while sliding
    slider.oninput = function () {
        priceVal.textContent = this.value;
        this.style.setProperty("--val", (this.value / this.max * 100) + "%");
    };

    // Submit when released
    slider.onchange = function () {
        form.submit();
    };
    </script>


{% endblock %}