{% extends "index.html" %}
{% block title %}Graphics Cards{% endblock %}

{% block content %}
<div class="shopc-product-page">

    <!-- FILTER SIDEBAR -->
    <aside class="shopc-filters">
        <h2>Filters</h2>

        <form method="GET" action="{% url 'powersupply' %}" id="filterForm">

            <!-- PRICE -->
            <div class="shopc-filter-group">
                <h4>Price</h4>
                <input type="range" 
                       id="priceSlider"
                       name="price"
                       min="0"
                       max="300000"
                       value="{{ request.GET.price|default:300000 }}">
                <div class="shopc-price-values">
                    <span>₹0</span>
                    <span id="priceValue">₹{{ request.GET.price|default:300000 }}</span>
                </div>
            </div>

        </form>
    </aside>

    <!-- PRODUCT LIST -->
    <main class="powersupply-products">
        <h2 style="color: white;">PowerSupply</h2>

        <div class="shopc-product-grid">

            {% for power in powersupply %}
            <div class="shopc-product-card">
                <a href="{% url 'product_detail' power.id %}" style="text-decoration: none;">
                    <div class="shopc-img-box">
                        {% if power.image %}
                        <img src="{{ power.image.url }}" alt="{{ power.name }}">
                        {% endif %}
                    </div>

                    <h3 class="shopc-product-name">{{ power.name }}</h3>

                    <div class="shopc-product-bottom">
                        <span class="shopc-price">₹{{ power.price }}</span>
                        <form action="{% url 'add_to_cart' power.id %}" method="post">
                            {% csrf_token %}
                            <button class="shopc-add-btn">Add to Cart</button>
                        </form>
                    </div>
                </a>

                {% comment %} buy-now  {% endcomment %}

                
                <div class="buy-now-div">
                    <a href="{% url 'buy_now_checkout' power.id %}">
                    <button class="buy-now">Buy Now</button>
                    </a>
                </div>

            </div>
            {% empty %}
            <p style="color: white;">No products found for selected filters.</p>
            {% endfor %}

        </div>
    </main>

</div>

<script>
    const slider = document.getElementById("priceSlider");
    const priceVal = document.getElementById("priceValue");
    const form = document.getElementById("filterForm");

    slider.style.setProperty("--val", (slider.value / slider.max * 100) + "%");

    slider.oninput = function () {
        priceVal.textContent = "₹" + this.value;
        this.style.setProperty("--val", (this.value / this.max * 100) + "%");
    };

    slider.onchange = function () {
        form.submit();
    };
</script>

{% endblock %}
